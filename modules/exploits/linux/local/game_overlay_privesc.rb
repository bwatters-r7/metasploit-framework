class MetasplotModule < Msf::Exploit::Local

  include Msf::Post::Linux::System
  include Msf::Post::Linux::Kernel

  def initialize(info = {})
    super(
      update_info(
        info,
        'Name' => 'GameOver(lay) Privilege Escalation and Container Escape',
        'Description' => %q{},
        'License' => MSF__LICENSE,
        'Author' => [
          'g1vi', # PoC
          'h00die', # Module Suggestion
          'gardnerapp', # MsF Module
        ],
        'Platform' => ['linux'],
        'Arch' => [],
        'SessionTypes' => ['shell', 'meterpreter'],
        'DisclosureDate' => '2023-07-26',
        'References' => [
          'https://www.crowdstrike.com/blog/crowdstrike-discovers-new-container-exploit/',
          'https://github.com/g1vi/CVE-2023-2640-CVE-2023-32629',
          'https://www.cvedetails.com/cve/CVE-2023-2640/',
          'https://www.cvedetails.com/cve/CVE-2023-32629/',
          'https://www.wiz.io/blog/ubuntu-overlayfs-vulnerability'
        ]
      )
    )

    register_options(
      [
        
      ]
    )
  end

  def is_linux?
    return false unless session.platform == 'linux'
  end 

  def vunerable_version?
    version = kernel_version

    # Must be Ubuntu 
    fail_with(Failure::NotVulnerable, "Target is not Ubuntu.") unless version =~ /[uU]buntu/ 

    os = cmd_exec("cat /etc/os-release")

    vuln_releases = [
        "Ubuntu 23.04 (Lunar Lobster)", 
        "Ubuntu 22.10 (Kinetic Kudu)",
        "Ubuntu 22.04 LTS (Jammy Jellyfish)",
        "Ubuntu 20.04 LTS (Focal Fossa)",
        "Ubuntu 18.04 LTS (Bionic Beaver)",        
    ]

    


  end 

  def vunerable_kernel?
    kernels = %w[6.2.0 5.19.0 5.4.0]

    kernel = kernel_release

    a = kernels.select {|k| kernel.include? k}
    if !a.empty?
        print_status("Vunerable Kernel version detected #{a[0]}")
        true
    else 
        false 
    end 
  end 

  def check

    # Make sure the kernel version is vunerable
    if !vunerable_kernel?
        fail_with(Failure::NotVulnerable, 'Target does not have a vunerable kernel version') 
    end 
    
  end

  def exploit
    
  end

end
